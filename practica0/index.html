<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enunciado Pr√°ctica UD4.PR0 - SGE</title>
    <style>
        :root {
            --primary: #714B67; /* Odoo Purple */
            --secondary: #00A09D; /* Odoo Teal */
            --accent: #E5973E; /* Odoo Warning Orange */
            --bg: #f8f9fa;
            --text: #212529;
            --code-bg: #2d2d2d;
            --code-text: #f8f8f2;
        }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: var(--text); background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h1 { color: var(--primary); border-bottom: 3px solid var(--secondary); padding-bottom: 15px; margin-top: 0; }
        h2 { color: var(--secondary); margin-top: 35px; border-left: 4px solid var(--secondary); padding-left: 10px; }
        h3 { color: #444; margin-top: 25px; }
        
        .setup-box { background: #e9ecef; padding: 20px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #dee2e6; display: flex; align-items: center; gap: 20px; flex-wrap: wrap;}
        .setup-box h3 { margin-top: 0; color: var(--primary); }
        
        .input-group { flex-grow: 1; }
        label { font-weight: bold; display: block; margin-bottom: 5px; color: var(--primary); }
        input[type="text"] { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ced4da; border-radius: 6px; transition: 0.3s; }
        input[type="text"]:focus { border-color: var(--secondary); outline: none; }

        .card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: 0.3s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        
        .code-area { position: relative; background: var(--code-bg); padding: 15px; border-radius: 6px; margin-top: 10px; }
        pre { margin: 0; overflow-x: auto; color: var(--code-text); font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; white-space: pre-wrap; }
        
        .copy-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 5px 12px; cursor: pointer; border-radius: 4px; font-size: 12px; transition: 0.2s; font-weight: bold; }
        .copy-btn:hover { background: var(--secondary); border-color: var(--secondary); }

        .warning-box { background: #fff3cd; color: #856404; padding: 15px; border-radius: 6px; border-left: 5px solid var(--accent); margin-top: 20px; }
        .checklist { list-style: none; padding: 0; }
        .checklist li { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .checklist li::before { content: "üì∏"; margin-right: 10px; }
        
        .file-icon { margin-right: 5px; }
        .folder { color: #f1c40f; font-weight: bold; }
        .file { color: #3498db; font-weight: bold; }

        .step-instruction { margin-bottom: 15px; padding-left: 15px; border-left: 3px solid #eee; }
        
        /* Tabs for OS selection in Step 1 */
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-top: 10px; }
        .tab { padding: 8px 15px; cursor: pointer; background: #f1f1f1; margin-right: 5px; border-radius: 5px 5px 0 0; border: 1px solid #ddd; border-bottom: none; font-size: 0.9em; color: #666; }
        .tab.active { background: white; color: var(--primary); font-weight: bold; border-top: 3px solid var(--primary); position: relative; top: 1px; }
        .tab-content { display: none; border: 1px solid #ddd; padding: 15px; border-radius: 0 5px 5px 5px; background: white; margin-top: -1px; }
        .tab-content.active { display: block; }

        footer { text-align: center; margin-top: 50px; color: #777; font-size: 0.9em; border-top: 1px solid #eee; padding-top: 20px;}
    </style>
</head>
<body>

<div class="container">
    <h1>üìù Pr√°ctica UD4.PR0: Despliegue Odoo en AWS</h1>
    <p><strong>Objetivo:</strong> Automatizar el despliegue de una instancia EC2 en AWS utilizando un script de "User Data" y documentar el proceso de restauraci√≥n desde una AMI base.</p>

    <!-- ZONA DE PERSONALIZACI√ìN -->
    <div class="setup-box">
        <div style="flex: 1;">
            <h3>üõ†Ô∏è Configuraci√≥n del Entorno</h3>
            <p style="margin: 0;">Introduce tus iniciales para personalizar los comandos Git.</p>
        </div>
        <div class="input-group">
            <label for="initials">Tus Siglas (Ej: AMM):</label>
            <input type="text" id="initials" placeholder="TUS_SIGLAS" onkeyup="updateCode()" autofocus>
        </div>
    </div>

    <div class="card">
        <h3>üìã Requisitos Previos</h3>
        <ul>
            <li>Tener configurado <strong>VS Code</strong> con tu repositorio privado <code>SGE.UD4.PRACT-<span class="dynamic-siglas">SIGLAS</span></code>.</li>
            <li>Disponer del archivo <code>.pem</code> (claves de AWS Academy).</li>
            <li>A√±adir un archivo <code>.gitignore</code> que incluya <code>*.pem</code>.</li>
            <li>Tener abierto el manual interactivo <strong><a href="manual_odoo.html" target="_blank" style="color:var(--secondary); text-decoration: none;">manual_odoo.html</a></strong>.</li>
        </ul>
    </div>

    <!-- PASO 0 -->
    <h2>0. Preparaci√≥n Repositorio (Seguridad)</h2>
    <p>Antes de escribir c√≥digo, debemos asegurar el entorno para poder conectar con AWS sin exponer nuestras credenciales.</p>
    
    <div class="card" style="border-left: 5px solid var(--accent);">
        <strong>Pasos a seguir obligatoriamente:</strong>
        <ol>
            <li>Descarga tu archivo de claves <code>.pem</code> (labsuser.pem o vockey.pem) desde el panel de AWS Academy.</li>
            <li>Copia ese archivo a la <strong>ra√≠z</strong> de tu repositorio local en VS Code.</li>
            <li>Crea un archivo llamado <span class="file">.gitignore</span> en la ra√≠z (si no existe ya).</li>
            <li>A√±ade la siguiente l√≠nea al final del archivo <code>.gitignore</code> para que Git ignore tu clave:</li>
        </ol>
        <div class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('gitignore-code')">Copiar</button>
<pre id="gitignore-code">
# Ignorar claves de seguridad AWS
*.pem
</pre>
        </div>
        <p style="margin-top: 10px; font-size: 0.9em;"><em>Esto asegurar√° que tu clave privada nunca se suba a GitHub/GitLab.</em></p>
    </div>

    <!-- PASO 1 - CONFIGURACI√ìN CLI -->
    <h2>1. Configuraci√≥n AWS CLI (Lab. Project Academy)</h2>
    <p>Para controlar AWS desde la terminal, necesitamos instalar y configurar la herramienta de l√≠nea de comandos (AWS CLI). Las credenciales del laboratorio son temporales y cambian en cada sesi√≥n.</p>

    <div class="step-instruction">
        <strong>1.1. Comprobar e Instalar AWS CLI:</strong><br>
        Abre una terminal y escribe <code>aws --version</code>. Si aparece un n√∫mero de versi√≥n, salta al paso 1.2. Si no, inst√°lalo seg√∫n tu sistema operativo:
        
        <div class="tabs">
            <div class="tab active" onclick="switchCliTab('win')">Windows</div>
            <div class="tab" onclick="switchCliTab('lin')">Linux Mint/Ubuntu</div>
        </div>

        <!-- Windows Install -->
        <div id="cli-win" class="tab-content active">
            <p>Descarga e instala el ejecutable oficial:</p>
            <a href="https://awscli.amazonaws.com/AWSCLIV2.msi" target="_blank" style="background: var(--primary); color: white; text-decoration: none; padding: 8px 15px; border-radius: 4px; display: inline-block;">üì• Descargar AWS CLI v2 para Windows</a>
            <p style="margin-top:10px; font-size:0.9em;"><em>Despu√©s de instalar, cierra y vuelve a abrir VS Code para que reconozca el comando.</em></p>
        </div>

        <!-- Linux Install -->
        <div id="cli-lin" class="tab-content">
            <p>Ejecuta estos comandos en tu terminal para instalarlo:</p>
            <div class="code-area">
                <button class="copy-btn" onclick="copyToClipboard('install-linux')">Copiar</button>
<pre id="install-linux">
sudo apt-get update
sudo apt-get install awscli -y
</pre>
            </div>
        </div>
    </div>

    <div class="step-instruction">
        <strong>1.2. Obtener Credenciales del Lab:</strong><br>
        En la web de AWS Academy, con el laboratorio iniciado (üü¢), haz clic en el bot√≥n <strong>AWS Details</strong>. Junto a "AWS CLI", haz clic en <strong>Show</strong>. Copia todo el bloque de texto que aparece.
    </div>

    <div class="step-instruction">
        <strong>1.3. Configurar en VS Code:</strong><br>
        Ejecuta el siguiente comando en la terminal de VS Code para editar tu archivo de credenciales:
        
        <div class="code-area" style="margin-bottom: 10px;">
            <button class="copy-btn" onclick="copyToClipboard('aws-config-cmd')">Copiar</button>
<pre id="aws-config-cmd">
# En Windows (PowerShell):
code $HOME\.aws\credentials

# En Linux/Mac:
code ~/.aws/credentials
</pre>
        </div>
        <em>(Si el archivo no existe, VS Code te preguntar√° si quieres crearlo. Di que s√≠. Si da error de carpeta no encontrada, cr√©ala manualmente).</em>
    </div>

    <div class="step-instruction">
        <strong>1.4. Pegar y Guardar:</strong><br>
        Borra cualquier contenido anterior en ese archivo y <strong>pega</strong> el bloque que copiaste de AWS Academy. Deber√≠a verse algo as√≠:
        <div class="code-area" style="background: #eee; color: #555;">
<pre style="color: #555;">
[default]
aws_access_key_id=ASIA...
aws_secret_access_key=wJalr...
aws_session_token=IQoJb...
region=us-east-1  # Comprobar que la Regi√≥n es correcta
</pre>
        </div>
        Guarda el archivo (Ctrl+S). ¬°Ya tienes acceso a AWS desde tu terminal!
    </div>

    <div class="step-instruction" style="border-left: 3px solid var(--secondary);">
        <strong>1.5. Comprobar Conexi√≥n (Importante):</strong><br>
        Antes de intentar crear m√°quinas, verifica que tienes acceso al laboratorio ejecutando este comando en la terminal de VS Code:
        
        <div class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('aws-check-id')">Copiar</button>
<pre id="aws-check-id">
aws sts get-caller-identity
</pre>
        </div>
        <p style="margin-top:10px;">Debes recibir una respuesta JSON como esta (si sale error, repite el paso 1.4):</p>
        <pre style="background: #eee; color: #333; padding: 10px; border-radius: 4px;">
{
    "UserId": "AROA...",
    "Account": "123456789...",
    "Arn": "arn:aws:sts::...:assumed-role/..."
}</pre>
    </div>

    <!-- PASO 2 -->
    <h2>2. Preparaci√≥n en VS Code</h2>
    <p>Abre tu repositorio en VS Code y aseg√∫rate de tener todo actualizado. Ejecuta estos comandos en la terminal integrada:</p>
    
    <div class="code-area">
        <button class="copy-btn" onclick="copyToClipboard('git-prep')">Copiar</button>
<pre id="git-prep">
# Asegurarnos de tener la √∫ltima versi√≥n
git pull

# Crear la carpeta de la pr√°ctica
mkdir UD4.PR0.ec2-desde-AMI
</pre>
    </div>

    <!-- PASO 3 -->
    <h2>3. Creaci√≥n del Script</h2>
    <p>Dentro de la carpeta <span class="folder">üìÇ UD4.PR0.ec2-desde-AMI</span> que acabas de crear, debes generar el siguiente archivo:</p>
    <ul>
        <li>Nombre del archivo: <span class="file">üìÑ odoo-boot.sh</span></li>
        <li><strong>Contenido:</strong> Copia el c√≥digo del <strong>Paso 1</strong> del archivo <code>manual_odoo.html</code>.</li>
    </ul>

    <!-- PASO 4 -->
    <h2>4. Ejecuci√≥n y Documentaci√≥n</h2>
    <p>Sigue los pasos del Manual Interactivo para lanzar la instancia en AWS. Mientras lo haces, crea un documento llamado <span class="file">üìÑ memoria_despliegue.pdf</span> con las siguientes capturas:</p>
    
    <ul class="checklist">
        <li><strong>Captura 1:</strong> Comprobaci√≥n de acceso al laboratorio (resultado de <code>aws sts get-caller-identity</code>).</li>
        <li><strong>Captura 2:</strong> El comando de lanzamiento en la terminal justo antes de pulsar Enter (debe verse el uso de <code>--user-data file://odoo-boot.sh</code>).</li>
        <li><strong>Captura 3:</strong> La consola de AWS mostrando la instancia en estado "En ejecuci√≥n" y tipo <code>t4g.small</code>.</li>
        <li><strong>Captura 4:</strong> Tu terminal SSH mostrando el log final con el mensaje <em>"--- Configuraci√≥n completada ---"</em>.</li>
        <li><strong>Captura 5 (Opcional):</strong> El navegador web mostrando Odoo cargando en la IP p√∫blica.</li>
    </ul>

    <!-- PASO 5 -->
    <h2>5. Entrega (Git Workflow)</h2>
    <p>Sube tu trabajo al repositorio remoto ejecutando los siguientes comandos:</p>

    <div class="code-area">
        <button class="copy-btn" onclick="copyToClipboard('git-push')">Copiar Comandos</button>
<pre id="git-push">
# A√±adir los archivos al √°rea de preparaci√≥n
git add UD4.PR0.ec2-desde-AMI/

# Confirmar los cambios
git commit -m "A√±ado pr√°ctica UD4.PR0 despliegue Odoo desde AMI - <span class="dynamic-siglas">SIGLAS</span>"

# Subir al repositorio remoto
git push
</pre>
    </div>

    <div class="warning-box">
        <strong>‚ö†Ô∏è SEGURIDAD CR√çTICA:</strong><br>
        Verifica una √∫ltima vez que tu archivo <code>.pem</code> NO est√° en la lista de archivos a√±adidos al commit. Si has configurado bien el <code>.gitignore</code> en el Paso 0, Git lo ignorar√° autom√°ticamente.
    </div>

    <footer>
        <p>Sistemas de Gesti√≥n Empresarial - 2025</p>
    </footer>

</div>

<script>
    function updateCode() {
        const initials = document.getElementById('initials').value || 'SIGLAS';
        const spans = document.querySelectorAll('.dynamic-siglas');
        spans.forEach(span => {
            span.textContent = initials;
        });
    }

    function switchCliTab(os) {
        document.getElementById('cli-win').classList.remove('active');
        document.getElementById('cli-lin').classList.remove('active');
        
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(t => t.classList.remove('active'));

        document.getElementById(`cli-${os}`).classList.add('active');
        // Simple toggle logic for tabs
        if(os === 'win') tabs[0].classList.add('active');
        else tabs[1].classList.add('active');
    }

    function copyToClipboard(elementId) {
        const el = document.getElementById(elementId);
        const text = el.innerText;
        
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector(`#${elementId}`).parentElement.querySelector('.copy-btn');
            const originalText = btn.innerText;
            btn.innerText = "¬°Copiado!";
            setTimeout(() => { btn.innerText = originalText; }, 2000);
        }).catch(err => {
            console.error('Error al copiar: ', err);
        });
    }
</script>

</body>
</html>