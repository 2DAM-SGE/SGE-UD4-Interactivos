<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual Despliegue Odoo 18 (AWS ARM)</title>
    <style>
        :root {
            --primary: #714B67; /* Odoo Purple */
            --secondary: #00A09D; /* Odoo Teal */
            --bg: #f8f9fa;
            --text: #212529;
            --code-bg: #1e1e1e;
            --code-text: #d4d4d4;
        }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: var(--text); background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); border-bottom: 2px solid var(--secondary); padding-bottom: 10px; }
        h2 { color: var(--secondary); margin-top: 30px; }
        .setup-box { background: #e9ecef; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 5px solid var(--primary); }
        .input-group { margin-bottom: 15px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 10px; font-size: 16px; border: 1px solid #ced4da; border-radius: 4px; max-width: 300px; }
        
        /* Code Tabs */
        .code-wrapper { margin-top: 15px; border: 1px solid #ddd; border-radius: 5px; overflow: hidden; }
        .tabs { display: flex; background: #f1f1f1; border-bottom: 1px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; font-weight: bold; color: #666; transition: 0.3s; }
        .tab:hover { background: #ddd; }
        .tab.active { background: white; color: var(--primary); border-top: 3px solid var(--primary); }
        
        /* Code Area */
        .code-area { position: relative; background: var(--code-bg); padding: 0; }
        pre { margin: 0; padding: 20px; overflow-x: auto; color: var(--code-text); font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; white-space: pre-wrap; }
        .copy-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 12px; transition: 0.2s; }
        .copy-btn:hover { background: var(--secondary); border-color: var(--secondary); }

        .note { background: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin-top: 10px; font-size: 0.9em; }
        .badge-arm { background: #ff9900; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üöÄ Despliegue Autom√°tico Odoo 18 (AWS)</h1>
    <p>Sigue esta gu√≠a para levantar tu servidor en <strong>AWS Academy</strong>. Esta configuraci√≥n utiliza arquitectura <span class="badge-arm">ARM64</span> (t4g.small) y configura Docker autom√°ticamente.</p>

    <div class="setup-box">
        <h3>üõ†Ô∏è Configuraci√≥n Inicial</h3>
        <p>Escribe tus iniciales aqu√≠ abajo. El c√≥digo se actualizar√° autom√°ticamente.</p>
        <div class="input-group">
            <label for="initials">Tus Siglas (Ej: AMM):</label>
            <input type="text" id="initials" placeholder="SIGLAS" onkeyup="updateCode()" value="SIGLAS">
        </div>
    </div>

    <h2>1. Crear el Script de Arranque</h2>
    <p>Primero, necesitamos crear el archivo que configurar√° la m√°quina. Ejecuta esto en tu terminal para crear el archivo <code>odoo-boot.sh</code>.</p>
    
    <div class="code-wrapper">
        <div class="tabs">
            <div class="tab active" onclick="switchTab(1, 'win')">Windows (PowerShell)</div>
            <div class="tab" onclick="switchTab(1, 'lin')">Linux Mint (Bash)</div>
        </div>
        
        <div id="step1-win" class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('code1-win')">Copiar</button>
<pre id="code1-win">
# En PowerShell, creamos el archivo usando notepad o code
notepad odoo-boot.sh

# (Pega el contenido del script de abajo en el bloc de notas y guarda)
</pre>
        </div>

        <div id="step1-lin" class="code-area" style="display:none;">
            <button class="copy-btn" onclick="copyToClipboard('code1-lin')">Copiar</button>
<pre id="code1-lin">
# En Linux, usamos nano o tu editor preferido
nano odoo-boot.sh

# (Pega el contenido del script de abajo y guarda con Ctrl+O, Enter, Ctrl+X)
</pre>
        </div>
    </div>

    <p style="margin-top:15px"><strong>Contenido del archivo <code>odoo-boot.sh</code></strong> (Copiar y pegar dentro del archivo):</p>
    <div class="code-wrapper">
        <div class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('boot-script')">Copiar Script</button>
<pre id="boot-script" style="color: #9cdcfe;">#!/bin/bash
# 1. Redirigir logs para depuraci√≥n
exec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1

echo "--- 1. Iniciando actualizaci√≥n del sistema (CR√çTICO) ---"
sleep 20
apt-get update
apt-get upgrade -y
apt-get install -y git curl

echo "--- 2. Instalando Docker y Docker Compose ---"
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
usermod -aG docker ubuntu
systemctl start docker
systemctl enable docker

echo "--- 3. Configurando SWAP (2GB) ---"
fallocate -l 2G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' | tee -a /etc/fstab
echo "vm.swappiness=10" >> /etc/sysctl.conf
sysctl -p

echo "--- 4. Preparaci√≥n de carpetas ---"
mkdir -p /home/ubuntu/odoo18-l10n-spain
chown -R ubuntu:ubuntu /home/ubuntu/odoo18-l10n-spain

echo "--- Configuraci√≥n completada ---"</pre>
        </div>
    </div>

    <h2>2. Lanzar la Instancia en AWS</h2>
    <p>Ahora ejecuta el comando para crear la m√°quina. Aseg√∫rate de estar en la carpeta donde guardaste el archivo anterior.</p>
    <div class="note">‚ö†Ô∏è <strong>Nota:</strong> Verifica que el <code>security-group-ids</code> y el <code>image-id</code> coinciden con los de tu laboratorio actual.</div>

    <div class="code-wrapper">
        <div class="tabs">
            <div class="tab active" onclick="switchTab(2, 'win')">Windows (PowerShell)</div>
            <div class="tab" onclick="switchTab(2, 'lin')">Linux Mint (Bash)</div>
        </div>

        <div id="step2-win" class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('code2-win')">Copiar</button>
<pre id="code2-win">
aws ec2 run-instances `
    --image-id ami-02e6a6320478bf846 `
    --count 1 `
    --instance-type t4g.small `
    --key-name vockey `
    --security-group-ids sg-0923c5b8a3a1b63c4 `
    --block-device-mappings '[{\"DeviceName\":\"/dev/sda1\",\"Ebs\":{\"VolumeSize\":25,\"VolumeType\":\"gp3\",\"DeleteOnTermination\":true}}]' `
    --user-data file://odoo-boot.sh `
    --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=Odoo18Base-<span class="dynamic-siglas">SIGLAS</span>}]'
</pre>
        </div>

        <div id="step2-lin" class="code-area" style="display:none;">
            <button class="copy-btn" onclick="copyToClipboard('code2-lin')">Copiar</button>
<pre id="code2-lin">
aws ec2 run-instances \
    --image-id ami-02e6a6320478bf846 \
    --count 1 \
    --instance-type t4g.small \
    --key-name vockey \
    --security-group-ids sg-0923c5b8a3a1b63c4 \
    --block-device-mappings '[{"DeviceName":"/dev/sda1","Ebs":{"VolumeSize":25,"VolumeType":"gp3","DeleteOnTermination":true}}]' \
    --user-data file://odoo-boot.sh \
    --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=Odoo18Base-<span class="dynamic-siglas">SIGLAS</span>}]'
</pre>
        </div>
    </div>

    <h2>3. Obtener la IP P√∫blica</h2>
    <p>Espera unos 30 segundos y ejecuta esto para ver tu IP.</p>

    <div class="code-wrapper">
        <div class="tabs">
            <div class="tab active" onclick="switchTab(3, 'win')">Windows (PowerShell)</div>
            <div class="tab" onclick="switchTab(3, 'lin')">Linux Mint (Bash)</div>
        </div>

        <div id="step3-win" class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('code3-win')">Copiar</button>
<pre id="code3-win">
aws ec2 describe-instances `
    --filters "Name=tag:Name,Values=Odoo18Base-<span class="dynamic-siglas">SIGLAS</span>" "Name=instance-state-name,Values=running" `
    --query "Reservations[*].Instances[*].[PublicIpAddress]" `
    --output text
</pre>
        </div>

        <div id="step3-lin" class="code-area" style="display:none;">
            <button class="copy-btn" onclick="copyToClipboard('code3-lin')">Copiar</button>
<pre id="code3-lin">
aws ec2 describe-instances \
    --filters "Name=tag:Name,Values=Odoo18Base-<span class="dynamic-siglas">SIGLAS</span>" "Name=instance-state-name,Values=running" \
    --query "Reservations[*].Instances[*].[PublicIpAddress]" \
    --output text
</pre>
        </div>
    </div>

    <h2>4. Verificaci√≥n Final</h2>
    <p>Con√©ctate por SSH (usando tu clave <code>labsuser.pem</code> o <code>vockey.pem</code>) y comprueba que la instalaci√≥n autom√°tica ha terminado. Sustituye <code>IP_PUBLICA</code> por la que obtuviste arriba.</p>
    
    <div class="code-wrapper">
        <div class="code-area">
            <button class="copy-btn" onclick="copyToClipboard('ssh-check')">Copiar</button>
<pre id="ssh-check">
# Conectar
ssh -i labsuser.pem ubuntu@IP_PUBLICA

# Una vez dentro, ver el log en tiempo real:
tail -f /var/log/user-data.log
</pre>
        </div>
    </div>
    <p>Cuando veas el mensaje <strong>"--- Configuraci√≥n completada ---"</strong>, pulsa <code>Ctrl + C</code>. ¬°Tu servidor est√° listo para recibir el Docker Compose!</p>

</div>

<script>
    // Funci√≥n para actualizar las siglas en tiempo real
    function updateCode() {
        const initials = document.getElementById('initials').value || 'SIGLAS';
        const spans = document.querySelectorAll('.dynamic-siglas');
        spans.forEach(span => {
            span.textContent = initials;
        });
    }

    // Funci√≥n para cambiar pesta√±as (Win vs Linux)
    function switchTab(step, os) {
        // Ocultar todos los bloques de c√≥digo del paso actual
        document.getElementById(`step${step}-win`).style.display = 'none';
        document.getElementById(`step${step}-lin`).style.display = 'none';
        
        // Desactivar pesta√±as
        const tabs = document.querySelectorAll(`.code-wrapper:nth-of-type(${step > 1 ? step - 1 : 1}) .tab`); // Selecci√≥n simplificada para demo
        // En un caso real seleccionamos por padre, aqu√≠ lo haremos simple por ID de bloque
        const parent = document.getElementById(`step${step}-${os}`).parentElement;
        const localTabs = parent.querySelectorAll('.tab');
        localTabs.forEach(t => t.classList.remove('active'));

        // Mostrar el seleccionado
        document.getElementById(`step${step}-${os}`).style.display = 'block';
        
        // Activar pesta√±a visualmente (un poco hacky pero funciona sin IDs √∫nicos en tabs)
        if(os === 'win') localTabs[0].classList.add('active');
        else localTabs[1].classList.add('active');
    }

    // Funci√≥n de copiado al portapapeles
    function copyToClipboard(elementId) {
        const el = document.getElementById(elementId);
        const text = el.innerText;
        
        navigator.clipboard.writeText(text).then(() => {
            alert("¬°C√≥digo copiado al portapapeles!");
        }).catch(err => {
            console.error('Error al copiar: ', err);
        });
    }
    
    // Inicializar listeners de pesta√±as correctamente
    document.querySelectorAll('.tabs').forEach((tabContainer, index) => {
        const stepNum = index === 0 ? 1 : (index === 1 ? 2 : 3); // Mapeo de √≠ndices a pasos
        if(index > 2) return; // Solo hay 3 pasos con pesta√±as dobles
        
        const tabs = tabContainer.querySelectorAll('.tab');
        tabs[0].onclick = () => switchTab(stepNum, 'win');
        tabs[1].onclick = () => switchTab(stepNum, 'lin');
    });

</script>

</body>
</html>